# cargo-deny configuration
# https://embarkstudios.github.io/cargo-deny/

[graph]
# Targets to check (all platforms we support)
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-unknown-linux-musl",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
    "x86_64-pc-windows-msvc",
]

[advisories]
# The database of security advisories
db-path = "~/.cargo/advisory-db"
# URL to the advisory database
db-urls = ["https://github.com/rustsec/advisory-db"]
# Ignore specific advisories (by RUSTSEC ID)
ignore = [
]

[licenses]
# List of allowed licenses (only include licenses actually used by dependencies)
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-3-Clause",
    "ISC",
    "Zlib",
    "Unicode-3.0",
    "BSL-1.0",
    # webpki-roots uses this permissive data license
    "CDLA-Permissive-2.0",
    # libbz2-rs-sys uses this permissive bzip2 license
    "bzip2-1.0.6",
]
# Confidence threshold for license detection
confidence-threshold = 0.8

# Clarify licenses for specific crates if needed
[[licenses.clarify]]
name = "ring"
expression = "MIT AND ISC AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

[bans]
# Lint level for multiple versions of the same crate
multiple-versions = "warn"
# Lint level for when a crate is used from a git repository
wildcards = "allow"  # Allow workspace path dependencies
# List of crates to deny
deny = []
# List of crates to allow
allow = []
# Skip specific versions (for transitive dependencies that have multiple versions)
# These are caused by different parts of the dependency tree requiring different versions
skip = [
    # ring requires 0.2.x, newer crates use 0.3.x
    { crate = "getrandom@0.2", reason = "ring dependency uses older version" },
    # Various crates in transition between windows-sys versions
    { crate = "windows-sys@0.60", reason = "transitive dependency version mismatch" },
]
# Skip checking tree for these crates
skip-tree = []

[sources]
# Allow crates from crates.io
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
# Allow git sources (for specific repos if needed)
allow-git = []
# Require all sources are from allowed registries
unknown-registry = "deny"
unknown-git = "deny"
